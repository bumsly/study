요약 : 박운성

# 크롬 개발자 도구를 활용한 애플리케이션 분석

## 7.1 크롬 개발자 도구란?

- 웹페이지에서 일어나는 거의 모든 일을 확인할 수 있는 크롬에서 제공하는 개발자용 도구이다.
- 크롬 개발자 도구 확인하는 방법
  - 디버깅하고 싶은 페이지에 접속 → 메뉴에서 보기 → 개발자 도구 선택
  - 웹페이지에서 마우스 오른쪽 버튼 클릭 → 검사 선택
  - 단축키
    ⇒ Windows: **F12** / Mac: **command + option + I**
- 크롬 개발자 도구
  ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/8e743b78-29ee-4932-8b95-b2675e453366/b27e8088-9639-471a-be1a-a9fd60d4735d/Untitled.png)
- 웹사이트를 제대로 디버깅하고 싶다면
  - 시크릿 (프라이빗) 모드에서 페이지와 개발자 도구 여는 것을 권장한다.
  - 이유 ⇒ 브라우저에 설치돼 있는 각종 확장 프로그램 때문이다.

## 7.2 요소 탭

- 크롬 개발자 도구에서 첫 번째로 노출되는 탭이다.
- 현재 웹페이지를 구성하고 있는 **`HTML`, `CSS`** 등의 정보를 확인할 수 있다.
- 크롬 개발자 도구의 요소 탭
  ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/8e743b78-29ee-4932-8b95-b2675e453366/b27e8088-9639-471a-be1a-a9fd60d4735d/Untitled.png)

### 7.2.1 요소 화면

- 왼쪽에는 현재 웹페이지를 구성하는 `HTML`을 나타낸다.
  - 원하는 태그를 클릭하면 브라우저 페이지의 해당 요소가 강조된다.
  - 해당 태그와 관련된 정보 확인이 가능하다.
  - 크롬 개발자 도구의 요소 탭에서 특정 요소를 클릭한 모습
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/8e743b78-29ee-4932-8b95-b2675e453366/5e7157c2-a108-459f-8be9-61ac47d33d6f/Untitled.png)
- 요소 화면에서는 직접 코드를 수정해서 어떻게 보이는지 빠르게 확인이 가능하다.
- 코드에 의해 클래스나 속성값이 동적으로 제어되는 DOM이 있다면 요소의 중단점을 사용해 디버깅 할 수 있다
  - 디버깅하고 싶은 요소를 선택 ⇒ 마우스 오른쪽 버튼 클릭 ⇒ 중단 위치 선택 ⇒ 원하는 옵션 클릭
  - 중단 위치를 설정해 두면 중단과 관련된 작업이 일어날 때마다 브라우저가 렌더링을 중단하고 해당 요소 변경을 일으킨 소스코드를 보여준다.
- 이 밖에도 요소에 속성을 추가, 수정, 삭제하거나 해당 요소를 스크린숏으로 캡처하거나 숨기는 등 `HTML DOM`과 관련된 다양한 작업을 수행할 수 있다.

### 7.2.2 요소 정보

- 요소 탭 오른쪽에서는 해당 요소와 관련된 정보를 얻을 수 있다.
- 스타일
  - 요소와 관련된 스타일 정보를 나타낸다.
  - 어떤 클래스, 태그명, 아이디 등으로 매핑되어 설정된 스타일인지 확인할 수 있다.
  - 스타일이 선언돼 있는 파일도 확인할 수 있다.
  - 스타일 정보의 내용을 수정해 페이지에 어떻게 반영되는지 미리 확인해 볼 수 있다.
- 계산됨
  - 해당 요소의 각종 `**CSS**` 적용 결괏값을 알 수 있는 탭이다.
  - 적용된 스타일이 어떤 결과물로 나타나는지 확인할 수 있다.
- 레이아웃
  - `**CSS**`그리드나 레이아웃과 관련된 정보를 확인할 수 있다.
- 이벤트 리스너
  - 현재 요소에 부착된 각종 이벤트 리스너를 확인할 수 있다.
  - 상위 버튼을 체크 해제하면 해당 요소에만 명확하게 부착된 이벤트만 볼 수 있다.
  - 이벤트 버블링 등으로 이벤트를 발생시키는 경우에는 확인할 수 없다.
  - 이후에 리액트 17의 변경 사항 중 하나인 이벤트 위임의 변경에서 확인해 본다.
- DOM 중단점
  - 앞서 설명한 중단점이 있는지 알려주는 탭이다.
- 속성
  - 해당 요소가 가지고 있는 모든 속성값을 나타낸다.
  - 자바스크립트에서 해당 DOM의 .attributes를 실행했을 때는 직접 할당된 값만 나오는 반면 속성 탭에는 모든 값이 나오는 차이가 있다.
- 접근성
  - 웹 이용에 어려움을 겪는 장애인, 노약자를 위한 스크린리더기 등이 활용하는 값을 말하는데, 이 탭에서는 이러한 접근성 정보를 확인할 수 있다,
- `**DOM**`과 관련된 정보가 필요하다면 이 요소 탭을 적극 활용하자.

## 7.3 소스 탭

- 웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일을 확인할 수 있다.
- 유용한 것을 살펴보려면 디버깅하고 싶은 파일을 직접 열어야 한다.
- 프로덕션 모드의 경우 파일이 모두 압축돼 있기 때문에 디버깅하기 매우 불편하다.
- 소스 중단점을 생성해 자바스크립트 실행을 중단시키고 디버깅을 수행할 수 있다.
  (이 방법은 소스코드를 오염시키지 않으므로 코드에 debugger를 선언하는 것보다 더 유용하다.)
- 사용 중인 라이브러리에서 버그가 의심되는 지점을 디버깅하거나 실제 소스코드상에서 어떤 식으로 작동하는지 확인하고 싶을 때 매우 유용하다.
- 소스 탭 오른쪽
  - 감시
    - 감시하고 싶은 변수를 선언하고, 해당 변수의 정보를 확인할 수 있는 메뉴이다.
    - 왼쪽에서 제공하는 변수 외에 디버깅 시점에서 특정 변수의 값을 알고 싶을 때 활용하면 된다.
    - 감시로 확인할 수 있는 정보가 있다 ⇒ 해당 변수의 값 표시
    - 감시로 확인할 수 있는 정보가 없다 ⇒ <not available> 표시
  - 중단점
    - 현재 웹사이트에서 추가한 중단점을 확인할 수 있다.
    - 웹페이지 전체에 걸쳐 소스 탭에서 추가한 모든 중단점을 확인할 수 있다.
  - 범위
    - 현재 중단점에서의 스코프를 의미한다.
    - 로컬
      ⇒ 현재 로컬 스코프를 의미하며 이 스코프에서 접근할 수 있는 값을 확인할 수 있다.
    - 이 밖에도 클로저, 전역 스코프 등을 확인할 수 있다.
  - 호출 스택
    - 현재 중단점의 콜스택을 확인할 수 있다.
    - 이 메뉴를 활용하면 자바스크립트 코드가 실행되며 생성되는 실행 콘텍스트가 어떻게 저장되어 현재 어떤 모습을 하고 있는지 직접 볼 수 있다.
  - 전역 리스너
    - 현재 전역 스코프에 추가된 리스너 목록을 확인할 수 있다,
  - XHR/가져오기, DOM, 이벤트 리스너, CSP 위반 중단점
    - 소스의 중단점 이외에 다양한 중단점을 확인할 수 있다.
- 웹사이트 디버깅 시 요소 탭과 더불어 가장 자주 사용되는 도구이므로 적극 활용해 보자.

## 7.4 네트워크 탭

- 해당 웹페이지를 접속하는 순간부터 발생하는 모든 네트워크 관련 작동이 기록된다.
- 웹페이지가 외부 데이터와 통신하는 정보를 확인하고 싶다면 네트워크 탭을 참조하면 된다.
- 탭 상단
  - 네트워크 탭과 관련된 다양한 메뉴를 확인할 수 있다.
  - 보고 싶은 네트워크 요청 종류를 필터링할 수 있다.
  - 보고 싶은 네트워크 종류를 제한할 수 있다.
- 탭 왼쪽
  - 실제 해당 페이지를 불러오는 과정에서 발생한 네트워크 요청을 볼 수 있다.
  - 네트워크 요청을 통해 페이지가 로딩되는 과정을 대략적으로 확인해 볼 수도 있다.
- 탭 하단
  - 페이지를 불러오는 기간 동안 발생한 총 요청 건수와 총 다운로드한 업로드 리소스의 크기를 확인할 수도 있다.
  - 모바일에서 발생하는 트래픽의 크기는 비용뿐만 아니라 속도에도 영향을 미치는 문제이므로 가급적 네트워크 리소스 요청 횟수와 크기를 줄일 필요가 있다.
  - 생각 이상으로 리소스 크기가 크다면 gzip이나 brotli를 활용해 리소스를 압축하거나 이미지를 최적화할 필요도 있다.
- 스크린숏 캡처 기능
  - 네트워크 요청 흐름에 따라 웹페이지가 어떻게 로딩되고 있는지 확인할 수 있다.
  - 이 기능을 통해 의도한 대로 페이지가 자연스럽게 완성되어가는지 확인해 보자.
- 네트워크 탭을 통해 집중적으로 확인해 봐야 하는 점
  - 불필요한 요청 또는 중복되는 요청이 없는지
  - 웹페이지 구성에 필요한 리소스 크기가 너무 크지 않은지
  - 리소스를 불러오는 속도는 적절한지 또는 너무 속도가 오래 걸리는 리소스는 없는지
  - 리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만들어가는지
- 네트워크 탭을 활용해 불필요한 네트워크 요청은 없는지 꼼꼼하게 확인한다면 더욱 빠르고 쾌적한 웹페이지를 만드는 데 큰 도움을 얻을 수 있을 것이다.

## 7.5 메모리 탭

- 현재 웹페이지가 차지하고 있는 메모리 관련 정보를 확인할 수 있다.
- 가장 난이도가 높고 까다로운 탭이지만 애플리케이션에서 발생하는 메모리 누수, 속도 저하, 혹은 웹페이지 프리징 현상을 확인할 수 있는 유용한 도구다.
- 메모리 탭을 열면 리액트 개발 도구의 프로파일과 비슷하게 프로파일링 작업을 거쳐야 원하는 정보를 볼수 있음을 확인할 수 있다.
- 프로파일 유형
  - 힙 스냅샷
    - 메모리 상황을 사진 찍듯이 촬영할 수 있다.
    - 현재 시점의 메모리 상황을 알고 싶을 때 활용하면 된다.
  - 타임라인의 할당 계측
    - 시간의 흐름에 따라 메모리의 변화를 살펴보고 싶을 때 사용하면 된다.
    - 주로 로딩이 되는 과정의 메모리 변화 또는 페이지에서 어떠한 상호작용을 했을 때 메모리의 변화 과정을 알고 싶을 때 사용한다.
  - 할당 샘플링
    - 메모리 공간을 차지하고 있는 자바스크립트 함수를 볼 수 있다.

### 7.5.1 자바스크립트 인스턴스 VM 선택

- 현재 실행 중인 자바스크립트 VM(Virtual Machine) 인스턴스를 확인할 수 있다.
- 여기서 먼저 디버깅하고 싶은 자바스크립트 VM 환경을 선택하면 된다.
- 환경별 힙 크기
  - 실제 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지 나타낸다.
  - 이 크기는 자바스크립트 실행에 따라 실시간으로 바뀐다.
  - 이 크기만큼 사용자의 브라우저에 부담을 주기 때문에 불필요하게 크기가 늘어나지 않는지 눈여겨볼 필요가 있다.

### 7.5.2 힙 스냅샷

- 현재 페이지의 메모리 상태를 확인해 볼 수 있는 메모리 프로파일 도구다.
- 촬영하는 시점을 기준으로 메모리 현황을 보여준다.
- 얕은 크기와 유지된 크기의 차이점
  - 얕은 크기란 객체 자체가 보유하는 메모리 바이트의 크기를 나타낸다.
  - 유지된 크기란 해당 객체 자체뿐만 아니라 다른 부모가 존재하지 않는 모든 자식 객체들의 크기까지 더한 값이다.
  - 메모리 누수를 찾을 때는 얕은 크기는 작으나 유지된 크기가 큰 객체를 찾아야 한다.
  - 두 크기의 차이가 큰 객체는 다수의 다른 객체를 참조하고 있다는 뜻이며, 해당 객체가 복잡한 참조 관계를 가지고 있다는 뜻이다.
  - 얕은 크기는 작으나 유지된 크기가 큰 객체가 오랜 시간 동안 메모리에 남아있다면 그로 인해 많은 메모리를 점유하고 있을 수 있다.
- 스냅샷을 활용할 때는 의심이 되는 지점을 먼저 추측해 본 뒤에 두 개 이상의 스냅샷을 보는 것이 훨씬 쉽다.
- 스냅샷을 활용하면 `useMemo`나 `useCallback`과 같은 의존성이 있는 값들이 정말로 렌더링 사이에 그대로 유지되는지 육안으로 직접 확인할 수 있다.
- 메모리 누수 원인을 더욱 정확하게 파악하려면 변수와 함수에 적절한 이름을 주어 수많은 메모리 내용 사이에서 눈에 띄게 하는 것이 큰 도움이 된다.

### 7.5.3 타임라인 할당 계측

- 시간의 흐름에 따라 메모리 변화를 확인할 수 있는 기능이다.
- 시간의 흐름에 따라 메모리의 변화를 모두 기록하기 때문에 상대적으로 많은 부담이 발생한다.
- 타임라인 할당 계측의 상단 그래프에서 검색을 원하는 범위를 좁히면 해당 기간에 메모리에 할당된 내용만 골라서 볼 수 있다.
- 특정 변수를 클릭해서 **전역 변수로 저장**을 누르면 해당 변수가 무슨 값을 가지고 있는 객체인지 확인할 수도 있다. (콘솔에서 해당 변수 확인 가능)
- 시간의 흐름에 따른 메모리 점유율을 자세히 알고 싶다면 타임라인 할당 계측을 활용하자.

### 7.5.4 할당 샘플링

- 할당 계측과 비슷하게 시간의 흐름에 따라 발생하는 메모리 점유를 확인할 수 있다.
- 할당 계측과 다르게 자바스크립트 실행 스택별로 분석할 수 있고, 이 분석을 함수 단위로 한다는 차이점이 있다.
- 할당 샘플링을 무거운 순으로 정렬하면 가장 많은 바이트를 차지한 함수의 작업이 맨 위로 올라오는데, 여기서는 문제가 되는 함수뿐만 아니라 오른쪽의 파일명을 누르거나 마우스 오른쪽 버튼을 클릭한 후 **소스 패널에 표시**를 선택해 해당 함수가 어느 파일에서 어떻게 정의됐는지도 확인할 수 있다.
- 타임라인 할당 계측과 유사하지만 프로파일링할 때 브라우저에 주는 부담을 최소화할 수 있어 장시간에 걸쳐 디버깅을 수행해야 할 때 유리하다.
- 메모리 누수가 짐작되지만 정확히 어디에서 발생하는 지 확인하기 어려워 힙 스냅샷을 촬영해 비교하기 어려운 경우, 오랜 기간 메모리 누수가 의심되어 프로파일링을 장기간 수행해야 하는 경우에는 할당 샘플링을 활용하는 것이 좋다.
